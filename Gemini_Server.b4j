AppType=StandardJava
Build1=Default,b4j.gemini.server
File1=index.html
FileGroup1=Default Group
Group=Default Group
Library1=jcore
Library2=jokhttputils2
Library3=jserver
Library4=json
Module1=GeminiHandler
Module2=Index
NumberOfFiles=1
NumberOfLibraries=4
NumberOfModules=2
Version=10.3
@EndOfDesignText@
'Non-UI application (console application)
' With help from DeepSeek
#Region  Project Attributes 
	#CommandLineArgs:
	#MergeLibraries: true 
#End Region

Sub Process_Globals
	Private srvr As Server
	Public StaticFilesFolder As String
	Public API_URL As String
	'Public USER_AGENT As String = "B4J-Gemini-Client/1.0"
	Public GEMINI_API_KEY As String
    Public GEMINI_MODEL As String = "gemini-2.5-pro"
    'Public GEMINI_MODEL As String = "gemini-3-pro-preview"
End Sub

' <link>Click to browse|http://127.0.0.1:51042/</link>
Sub AppStart (Args() As String)
	srvr.Initialize("srvr")
	srvr.Port = 51042 ' default
	srvr.StaticFilesFolder = File.Combine(File.DirApp, "www")
	srvr.LogsFileFolder = File.Combine(File.DirApp, "logs")
	srvr.AddHandler("", "Index", False)
	srvr.AddHandler("/gemini", "GeminiHandler", False)
	srvr.Start
	'DateTime.DateFormat = "yyyy-MM-dd_HHmmss"
	If File.Exists(File.DirApp, "env.txt") = False Then
		File.WriteMap(File.DirApp, "env.txt", CreateMap("GEMINI_API_KEY": "YOUR_API_KEY_HERE"))
		LogColor("Please set your Gemini API key in env.txt", -65536)
		Return
	End If
	Dim env As Map = File.ReadMap(File.DirApp, "env.txt")
	GEMINI_API_KEY = env.Get("GEMINI_API_KEY")
	If GEMINI_API_KEY = "" Or GEMINI_API_KEY = "YOUR_API_KEY_HERE" Then
		LogColor("Please set your Gemini API key in env.txt", -65536)
		Return
	End If	
	Log("Server started")
	StartMessageLoop
End Sub